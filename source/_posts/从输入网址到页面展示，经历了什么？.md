---
title: 从输入网址到页面展示，经历了什么？
date: 2018-03-04 00:34:55
tags: 前端概览

---


在前端开发中我们常常需要考虑首屏加载时间，为了尽可能减少首屏加载时间我们需要弄清楚从输入网址到页面最终呈现的过程中都发生了哪些事情，然后才能具体问题具体分析，最终达到提升网页性能的目的。从输入网址到页面呈现这个过程大致可分为以下这几个部分：

<!-- more -->
 1. 网络通信
 2. 页面渲染

## 网络通信 ##

 1. 输入网址，告诉浏览器域名；

 > 一个完整的URL包括协议、服务器地址(主机)、端口、路径。
 
 2. 负责域名查询与解析的DNS服务器，域名转换为ip；

 > 检查操作系统hosts文件是否有这个网址映射关系；
 --->查找本地DNS解析器缓存，是否有这个网址映射关系；
 --->查找本地DNS服务器,是否有这个网址映射关系；
 --->本地DNS服务器把请求发至13台根DNS服务器，进行迭代查询；
 --->直至最后把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。
 注：从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。

 3. 应用层，客户端发送HTTP（TCP协议）请求报文；

 > 报文信息可参考[HTTP协议详解][1]

 4. 传输层，三次握手建立连接；

 > 发送端先发送一个带有SYN（synchronize）标志的数据包给接收端，接收端收到数据包后，传回一个带有SYN/ACK标志的数据包以示传达确认信息。发送方收到后再发送一个带有ACK标志的数据包给接收端以示握手成功。

 5. 网络层，负责传输的IP协议；

 > IP协议的作用是把将ip映射（ARP协议）为mac地址
    
 6. 链路层，数据按照mac地址发送回客户端；

 > 客户端发送请求的阶段结束，服务端将数据封装到响应报文，并通过mac地址往客户端发送响应报文。
    
 7. 传输层，三次握手建立连接；

 > 同上；

 8. 应用层，接收服务端HTTP（TCP协议）响应报文；

 > 同上；

**网络通信阶段对前端优化建议**
 
- 减少HTTP请求数，利用webpack合并资源；
- 避免重定向（重定向会增加http请求次数）；
- cookie优化，cookie越多会导致请求头越大；
- 使用CDN加速，减小服务器压力；
- 合理利用HTTP缓存，通过设置Expires；
 

## 页面渲染 ##

 1. 解析html以构建DOM树

 > “解析树”是由 DOM 元素和属性节点构成的树结构，解析树的根节点是“Document”对象。

 2. 解析css以构建CSSOM树

 > 当解析到link标签时会请求相应的CSS文件，并将其CSS规则解析为StyleSheet对象；

 3. 构建render树

 > 连接CSSOM树和DOM树形成一个render树，构建render树的时候需要为DOM树匹配CSS规则，在这个阶段因为匹配规则是从右往左匹配的，所以css的编写规则很重要；

 4. 布局render树

 > 布局是一个递归的过程，它从根元素开始，然后递归遍历部分或所有的框架层次结构，为每一个需要计算的呈现器计算几何信息。

 5. 绘制render树

 > 在绘制阶段，系统会遍历render树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。当布局发生改变时调用“回流”方法，而布局空间不变只是显示变化时，则调用“重绘”方法。
 
 注：当解析到 script 标签时，将启动 JavaScript 引擎，这时将阻塞 DOM 树的构建。

**页面渲染阶段对前端优化建议**

 - 建议将 CSS 文件放在页首，以便构建 DOM 树；而将 JavaScript 文件尽量放在页面下方，防止阻塞构建 DOM 树；
 - JavaScript 的 onload 事件里，不要写太多影响首屏渲染的、操作 DOM 树的 JavaScript 代码；
 - 精简 JavaScript 和 CSS 代码，并进行代码压缩，使得css和js资源更快的下载；
 - 编写高效的CSS代码；
 - 重要的图片或者想让用户优先看到的图片使用img标签，次要的图片使用background引入

 
 
  [1]: https://showver.github.io/2017/12/28/HTTP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/