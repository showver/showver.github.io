---
title: 从输入网址到页面展示，经历了什么？
date: 2018-03-09 10:36:15
tags:
---

##简介##

在前端开发中我们常常需要考虑首屏加载时间，<!-- more -->为了尽可能减少首屏加载时间我们需要弄清楚从输入网址到页面最终呈现的过程中都发生了哪些事情，然后才能具体问题具体分析，最终达到提升网页性能的目的。从输入网址到页面呈现这个过程大致可分为以下这几个部分：

 1. 网络通信
 2. 页面渲染

<!--more-->

## 网络通信 ##

要分析网络通信就离不开OSI七层网络模型，接下来以TCP/IP五层模型分析：

 1. 输入网址（属于WWW服务），告诉浏览器域名；

 > 一个完整的URL包括协议、服务器地址(主机)、端口、路径。
 
 2. 应用层，根据DNS协议将域名解析为IP地址，再通过HTTP协议封装请求信息；

 DNS协议解析过程：

 > 检查操作系统hosts文件是否有这个网址映射关系；
 --->查找本地DNS解析器缓存，是否有这个网址映射关系；
 --->查找本地DNS服务器,是否有这个网址映射关系；
 --->本地DNS服务器把请求发至13台根DNS服务器，进行迭代查询；
 --->直至最后把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。
 注：从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。

 HTTP协议封装过程：

 > 在请求行（状态行）中，分装了**请求方法**、**请求地址**、**HTTP协议及版本**；
 在请求头（响应头）中，包含若干个属性，格式为“key:value”，服务端据此获取客户端的信息
 在空行中，空行用于分隔报文头与报文体；
 在请求体（响应体）中，即我们真正要的“干货”。

 3. 传输层，根据TCP协议进行三次握手连接，提供进程间的逻辑通信（进程到进程通信），确认端口；

 > 发送端先发送一个带有SYN（synchronize）标志的数据包给接收端，接收端收到数据包后，传回一个带有SYN/ACK标志的数据包以示传达确认信息。发送方收到后再发送一个带有ACK标志的数据包给接收端以示握手成功。

 4. 网络层，负责传输的IP协议，提供主机间的逻辑通信（主机到主机通信），确认主机；

 > 调用ARP协议将ip映射为mac地址
    
 5. 链路层，数据按照mac地址发送回客户端；

 > 将物理层的比特流信息封装为帧，；
 
 6. 物理层，即服务器。


**注：**
 * 基于http协议的除了www服务，还有ftp服务、Archie、SMTP、NNTP等；
 * http协议是基于tcp协议，而dns协议是基于udp协议；


## 页面渲染 ##

 1. 解析html以构建DOM树

 > “解析树”是由 DOM 元素和属性节点构成的树结构，解析树的根节点是“Document”对象。

 2. 解析css以构建CSSOM树

 > 当解析到link标签时会请求相应的CSS文件，并将其CSS规则解析为StyleSheet对象；

 3. 构建render树

 > 连接CSSOM树和DOM树形成一个render树，构建render树的时候需要为DOM树匹配CSS规则，在这个阶段因为匹配规则是从右往左匹配的，所以css的编写规则很重要；

 4. 布局render树

 > 布局是一个递归的过程，它从根元素开始，然后递归遍历部分或所有的框架层次结构，为每一个需要计算的呈现器计算几何信息。当布局发生改变时，在这里调用“回流”方法。

 5. 绘制render树

 > 在绘制阶段，系统会遍历render树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。当布局空间不变只是显示变化时，在这里调用“重绘”方法。
 
 注：当解析到 script 标签时，将启动 JavaScript 引擎，这时将阻塞 DOM 树的构建。



